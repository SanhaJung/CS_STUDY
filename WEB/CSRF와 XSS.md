# CSRF와 XSS

## CSRF란

Cross-Site-Request-Forgery의 약어로 사이트 사이 요청을 위조한다는 의미

<br/>

- 사용자와 특정 웹간의 통신을 할때 Request와 Response를 분석해서 Request(요청)을 위조하여 공격자가 원하는 행위를 하게 만드는 공격
- 사용자는 자신이 의도했던 것과 무관하게 공격자가 의도한 행위를 하게 만드는 공격으로, 회원정보 변경,데이터 수정/삭제, 게시글 내용 변경등을 할 수 있음
- 특정 사용자의 권한이 필요할때(Ex: 권리자 권한)타겟이 로그인 된 상태에서 악성 스크립트가 존재하는 페이지 또는 악성 URL을 통해 공격이 가능함
- CSRF 공격은 악성 스크립트가 아니더라도 가능함

<br/>

## CSRF 공격 방식

![CSRF](images\CSRF와XSS\attack.PNG)

- 악성 스크립트등을 통해 조작할 내용의 게시글 작성
- 악성 게시글은 DB에 저장됨
- 관리자 또는 특정 사용자가 공격자가 작성한 게시글을 클릭
- 악성 게시글은 사용자가 웹 클라이언트를 통해 읽혀지는 동안 클라이언트 언어로 인식되어 동작
  - 악성 스크립트가 동작하며 특정 사용자의 권한이 필요할 경우 해당 권한을 통해 동작함
- 희생자에겐 정상적인 게시글로 동작

<br/>

## CSRF의 특징

- XSS와 함께 웹에서 가장 효과적인 공격방법
- 단, 스크립트가 없어도 공격이 가능한 방법
- 정상 사용자를 통해 공격이 진행되므로 공격자의 정보(IP등)를 추적하는 것이 불가능

<br/>

## CSRF 방지법

1. 위조 방지 토큰 사용

- 특정 권한이 필요한 페이지는 해당 페이지와 실제 동작이 일어나는 페이지사이에 토큰을 생성해 그 값을 비교하여 토큰이 존재하지 않거나 다른 경우 동작 허용X

2. Referer값 이용

- 프록시 툴, 패킷 등을 통해 확인하면 다른 페이지로 이동할 경우 그전 페이지 정보를 가지고 이동함.
- 이때 전페이지 정보가 없거나, 외부사이트에서 요청을 한 경우 요청을 처리하지 않는 방법이 있음

3. 캡쳐 사용

- 회원정보 변경, 게시글 작성등 CSRF의 공격을 막아야 하는 페이지에서 캡쳐를 사용해 인증이 가능한 것만 요청을 처리해주는 방법이 있음
- 캡쳐는 랜덤 이미지를 통해 인증이 되므로 사용자 몰래 요청하는 것이 불가능하다는 장점이 있음

<br/>

## XSS란

유저가 웹페이지에 접속하는 것으로, 올바르지 않은 스크립트가 실행되는 취약점 또는 공격방법

![XSS](images\CSRF와XSS\xss.PNG)

<br/>

- 일반 유저가 웹페이지에 악성 스크립트를 삽입할 수 있는 취약점

<br/>

## XSS의 위헙성

- 쿠키 및 세션 정보 탈취
- 악성 프로그램 다운 유도
- 의도하지 않은 페이지 노출
  - 태그등을 삽입해 원본페이지와 전혀 관련없는 페이지 노출

<br/>

## XSS의 공격 종류

1. Reflected XSS
   - 공격자가 악성 스크립트를 클라이언트에게 직접전달
   - URL안에 스크립트를 포함시켜 공격
   - 서버에 스크립트를 저장하지 않기 때문에 서버에서 이루어지는 필터링을 피할 수 있는 공격 방식

<br/>

2. Stored XSS

   - 악성 스크립트를 서버에 저장시킨 다음 클라이언트 요청/응답 과정을 통해 공격
   - 서버에서 필터링을 하므로 공격을 우회하기 어렵지만, 한번 성공시 눈치채기 힘들고 광범위한 피해를 줄 수 있음

3. DOM Based XSS
   - 피해자의 브라우저가 html페이지를 분석하여 DOM을 생성할 때 악성 스크리브가 DOM의 일부로 구성되어 생성되는 공격
   - 정상적인 스크립트가 실행되면서 악성 스크립트가 추가되서 실행됨

<br/>

## XSS의 대응 방법

- 입력 값의 길이제한(이메일, 아이디, 패스워스등)
- replace등의 함수를 이용한 치환
- '<','>'와 같이 태그에 사용되는 기호를 엔티티코드로 변환
- 입력 값에 대한 꼼꼼한 유효성 검사

<br/>

## CSRF와 XSS의 차이점

![vs](images\CSRF와XSS\vs.PNG)

<br/>

---

## 예상 질문

📌CSRF와 XSS의 차이점

📌CSRF와 XSS의 정의

---

## 🔗 Reference

- https://kk-7790.tistory.com/73
- https://velog.io/@leejihun96/XSS%EC%99%80-CSRF
- https://tibetsandfox.tistory.com/5
