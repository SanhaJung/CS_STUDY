# JWT(JSON Web Token)

> Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token이다.  
> 토큰 자체를 정보로 사용하는 Self-Contained 방식으로 정보를 안전하게 전달한다.

_클레임(Claim) : 토큰에 담는 정보의 한 '조각', 즉 사용자 정보나 데이터 속성 등을 의미_

```json
{
	"id": "example",
	"role": ["admin", "hr"],
	"company": "ssafy"
}
```

<br/>

## 구성요소

JSON객체는 Base64 URL-Safe 인코딩된 문자열이다.

> _JWT의 일반적인 구성_ : 헤더, 내용, 서명 순이며 점(.)으로 구분된다.  
> xxxxx.yyyyy.zzzzz

### [헤더(Header)]

: 토큰 유형과 해시 암호화 알고리즘

```json
{
	"alg": "HS256",
	"typ": "JWT"
}
```

### [정보(Payload)]

토큰에 담을 클레임을 포함한다. name-value 한 쌍으로 이루어져 있다.
여러 개의 클레임들을 토큰에 넣을 수 있지만 길이가 길어질 수 있다.
claim의 유형 : _등록, 공개, 비공개클레임_

1. 등록된(registered) 클레임

   > 필수는 아니지만 유용하고 상호 운용 가능한 클레임 집합을 제공하기 위해 권장되는 정의된 클레임의 집합이다.

   등록된 클레임의 사용은 모두 선택적이며 다음과 같다.

   - iss(issuer) : 토큰 발급자
   - exp(expiration time) : 토큰의 만료시간
   - sub(sbuject): 토큰 제목
   - aud(audience): 토큰 대상자

<br>

2. 공개(public) 클레임 - 사용자 정의 Claim

   > 공개 클레임들은 충돌이 방지된(collision-resistant)이름을 가지고 있어야 한다.  
   > 충돌을 방지하기 위해서, 클레임 이름을 URI 형식으로 짓는다.

   ```json
   {
   	"https://jwtexample.com": true
   }
   ```

   <br>

3. 비공개(private) 클레임 - 사용자 정의 Claim
   > 양 측간(서버 - 클라이언트) 합의 하에 사용되는 클레임 이름들이다.  
   > 이름이 중복되어 충돌이 될 수 있어 사용에 주의해야 한다.

#페이로드 예시

```json
{
	"sub": "1234567890",
	"name": "John Doe",
	"admin": true
}
```

### [서명(Signature)]

> secret key를 포함하여 암호화되어 있다.  
> 서명 부분을 생성하기 위해서는, 인코딩된 헤더, 인코딩된 페이로드, 주어진 비밀키, 헤더에 지정된 알고리즘을 가져와서 서명한다.

<br>
<br>

## 사용

- 회원 인증 : 사용자가 로그인 시, 서버는 사용자의 정보를 기반으로 하여 토큰을 발급한다. 사용자가 서버에 요청을 할 때마다, JWT를 포함하여 전달하고 서버는 클라이언트에서 요청을 받을 때마다, 해당 토큰의 유효성 인증을 검증한다. 그리고 사용자가 요청한 작업의 권한 여부를 확인한 뒤 작업을 처리한다.

  💡 서버가 사용자에 대한 세션을 유지할 필요가 없다.  
  💡 사용자 요청 시 토큰만 확인하면 되기 때문에, 서버 자원과 비용 절감이 가능하다.

- 정보 교류 : JWT는 두 개체 사이에서 정보를 안정성있게 교환하기 좋다. 정보가 서명 되어있기 때문에 정보를 보낸 이, 정보 조작 여부를 검증할 수 있다.

<br>

## 취약성

JSON 웹 토큰은 세션 상태를 포함한다. 하지만 프로젝트 요건이 JWT 기간 만료 전에 세션 무효화를 허용할 경우, 서비스는 토큰 표명을 신뢰할 수 없다.

<br>

💡 알고리즘 취약성 해결

1. JWT 헤더만으로 유효성 확인하지 않기
2. 알고리즘 인지
3. 적절한 키 크기 사용

<br>

## 로그인 인증

❗️ Access Token(JWT)를 통한 인증 방식은 제 3자에게 탈취당할 경우 보안에 취약하다는 점이다.  
💡 유효기간을 짧게 한 Refresh Token을 사용하여 보완하자!

- Refresh Token은 Access Token과 같은 JWT이다.
- Access Token과 Refresh Token을 발급하는데 Refresh Token은 긴 유효기간을 가지고, Access Token이 만료되었을 때 새로 발급해준다.
- Refresh Token의 유효기간도 만료되었다면, 사용자는 새로 로근인을 해야 한다.

_Refresh Token도 탈취될 수 있기 때문에 적절한 유효기간을 설정할 필요가 있다._
<br>
<br>

<hr/>

### 예상 질문

📌 JWT에 대해 간단히 설명해주세요.

> JSON Web Token의 약자로, Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token입니다.
> 토큰 자체를 정보로 사용하기 때문에 정보를 안전하게 전달합니다.

<br/>

📌 프로젝트에서 JWT를 사용하여 회원 인증하신 거 같은데, JWT를 사용하신 이유가 있으신가요?

> JWT는 서버가 사용자에 대한 세션을 유지할 필요가 없습니다. 사용자 요청 시 토큰만 확인하면 되기 때문에, 서버 자원과 비용 절감이 가능하다는 장점때문에 사용하였습니다.

<br/>
<br/>
<br/>

## 🔗 Reference

- https://jwt.io/introduction
